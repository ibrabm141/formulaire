<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù† - ØªÙ‚Ø±ÙŠØ± Ù…ØªÙ‚Ø¯Ù…</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Ø§Ø³ØªØ§ÙŠÙ„Ø§Øª + Ù…ÙƒØªØ¨Ø§Øª -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@5/dark.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap");

      body {
        font-family: "Cairo", sans-serif;
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
        color: #fff;
        padding: 25px 10px;
        overflow-x: hidden;
        user-select: none;
      }
      .container {
        max-width: 1200px;
        margin: auto;
        background: rgba(0, 0, 0, 0.75);
        border-radius: 20px;
        padding: 25px 30px 40px 30px;
        box-shadow: 0 0 40px #00bfffcc;
        position: relative;
      }
      h2 {
        text-align: center;
        font-size: 2.8rem;
        margin-bottom: 35px;
        text-shadow: 0 0 15px #00bfffaa;
        user-select: text;
      }
      .stat-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        margin-bottom: 30px;
      }
      .card {
        background: rgba(255, 255, 255, 0.08);
        padding: 20px;
        border-radius: 15px;
        flex: 1 1 180px;
        text-align: center;
        backdrop-filter: blur(12px);
        box-shadow: 0 0 15px #00d8ffcc;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: default;
        user-select: none;
      }
      .card:hover {
        transform: translateY(-8px);
        box-shadow: 0 0 25px #00eaffdd;
      }
      .card h3 {
        margin-bottom: 8px;
        font-size: 1.4rem;
        font-weight: 700;
        user-select: text;
      }
      .card p {
        font-size: 1.8rem;
        font-weight: 900;
        letter-spacing: 0.05em;
        user-select: text;
      }
      .progress {
        background-color: #ffffff33;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 12px;
        height: 25px;
        box-shadow: inset 0 0 10px #00000055;
      }
      .progress-bar {
        height: 100%;
        background: linear-gradient(45deg, #00c6ff, #0072ff);
        text-align: center;
        line-height: 25px;
        color: #fff;
        font-weight: 700;
        font-size: 1rem;
        transition: width 0.7s ease-in-out;
        user-select: text;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 25px;
        background-color: #00000044;
        color: #e0e0e0;
        border-radius: 15px;
        overflow: hidden;
        user-select: text;
      }
      th,
      td {
        padding: 12px 10px;
        text-align: center;
        border-bottom: 1px solid #ffffff22;
        font-size: 0.9rem;
      }
      th {
        background-color: #00bfff55;
        font-weight: 700;
        font-size: 1rem;
        user-select: text;
      }
      tr:hover {
        background-color: #0072ff33 !important;
      }
      button {
        padding: 12px 28px;
        margin: 12px 8px;
        font-weight: 900;
        border-radius: 20px;
        cursor: pointer;
        border: none;
        background: linear-gradient(135deg, #1abc9c, #16a085);
        color: #fff;
        font-size: 1rem;
        box-shadow: 0 6px 10px #16a085aa;
        transition: all 0.35s ease;
        user-select: none;
      }
      button:hover {
        background: linear-gradient(135deg, #16a085, #1abc9c);
        box-shadow: 0 8px 16px #16a085cc;
        transform: translateY(-3px);
      }
      #confetti-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
        z-index: 9999;
      }
      #genderChart {
        max-width: 320px;
        margin: 20px auto 35px;
        user-select: none;
      }
      /* Ø±Ø³ÙˆÙ…Ø§Øª Ù…ØªØ­Ø±ÙƒØ© Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
      .count-up {
        animation: countUpEffect 1.5s ease forwards;
        opacity: 0;
        transform: translateY(20px);
      }
      @keyframes countUpEffect {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      /* Ø·Ø¨Ø§Ø¹Ø© */
      @media print {
        button,
        #confetti-canvas,
        #genderChart {
          display: none !important;
        }
        body {
          background: #fff !important;
          color: #000 !important;
          user-select: text !important;
        }
        table {
          background: none !important;
          color: #000 !important;
        }
        th,
        td {
          border: 1px solid #000 !important;
        }
      }
    </style>
  </head>
  <body>
    <canvas id="confetti-canvas"></canvas>

    <div class="container" role="main" aria-labelledby="title">
      <h2 id="title" tabindex="0">
        Ù†ØªØ§Ø¦Ø¬ Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© ÙˆØ§Ù„Ø£Ø®Ù„Ø§Ù‚ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
      </h2>

      <section class="stat-cards" aria-label="Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©">
        <article class="card" tabindex="0" aria-describedby="desc-total">
          <h3>ğŸ‘¥ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ†</h3>
          <p
            id="count-total"
            class="count-up"
            aria-live="polite"
            aria-atomic="true"
          >
            {{ total }} Ù…Ø´Ø§Ø±Ùƒ
          </p>
          <span id="desc-total" class="sr-only"
            >Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†</span
          >
        </article>

        <article class="card" tabindex="0" aria-describedby="desc-females">
          <h3>ğŸ‘©â€ğŸ“ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø§Ø«</h3>
          <div
            class="progress"
            role="progressbar"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="{{ female_percent }}"
            aria-describedby="desc-females"
          >
            <div
              class="progress-bar"
              id="bar-females"
              style="width: {{ female_percent }}%;"
            >
              {{ female_percent }}%
            </div>
          </div>
          <p>Ø§Ù„Ø¹Ø¯Ø¯: {{ females_count }} Ù…Ø´Ø§Ø±ÙƒØ©</p>
          <span id="desc-females" class="sr-only"
            >Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø§Ø« Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</span
          >
        </article>

        <article class="card" tabindex="0" aria-describedby="desc-males">
          <h3>ğŸ‘¨â€ğŸ“ Ù†Ø³Ø¨Ø© Ø§Ù„Ø°ÙƒÙˆØ±</h3>
          <div
            class="progress"
            role="progressbar"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="{{ male_percent }}"
            aria-describedby="desc-males"
          >
            <div
              class="progress-bar"
              id="bar-males"
              style="width: {{ male_percent }}%;"
            >
              {{ male_percent }}%
            </div>
          </div>
          <p>Ø§Ù„Ø¹Ø¯Ø¯: {{ males_count }} Ù…Ø´Ø§Ø±Ùƒ</p>
          <span id="desc-males" class="sr-only"
            >Ù†Ø³Ø¨Ø© Ø§Ù„Ø°ÙƒÙˆØ± Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</span
          >
        </article>

        <article class="card" tabindex="0" aria-describedby="desc-age-under15">
          <h3>ğŸ§’ Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø£Ù‚Ù„ Ù…Ù† 15 Ø³Ù†Ø©</h3>
          <div
            class="progress"
            role="progressbar"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="{{ percent_under_15 }}"
            aria-describedby="desc-age-under15"
          >
            <div
              class="progress-bar"
              style="width: {{ percent_under_15 }}%;"
              id="bar-under-15"
            >
              {{ percent_under_15 }}%
            </div>
          </div>
          <p>Ø§Ù„Ø¹Ø¯Ø¯: {{ under_15_count }} Ù…Ø´Ø§Ø±Ùƒ</p>
          <span id="desc-age-under15" class="sr-only"
            >Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø§Ù„Ø°ÙŠÙ† ØªÙ‚Ù„ Ø£Ø¹Ù…Ø§Ø±Ù‡Ù… Ø¹Ù† 15
            Ø³Ù†Ø©</span
          >
        </article>

        <article class="card" tabindex="0" aria-describedby="desc-age-15-18">
          <h3>ğŸ§‘ Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø¨Ø§Ø¨ Ø¨ÙŠÙ† 15 Ùˆ18 Ø³Ù†Ø©</h3>
          <div
            class="progress"
            role="progressbar"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="{{ percent_15_18 }}"
            aria-describedby="desc-age-15-18"
          >
            <div
              class="progress-bar"
              style="width: {{ percent_15_18 }}%;"
              id="bar-15-18"
            >
              {{ percent_15_18 }}%
            </div>
          </div>
          <p>Ø§Ù„Ø¹Ø¯Ø¯: {{ between_15_18_count }} Ù…Ø´Ø§Ø±Ùƒ</p>
          <span id="desc-age-15-18" class="sr-only"
            >Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø¨Ø§Ø¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø§Ù„Ø°ÙŠÙ† ØªØªØ±Ø§ÙˆØ­ Ø£Ø¹Ù…Ø§Ø±Ù‡Ù… Ø¨ÙŠÙ† 15 Ùˆ18
            Ø³Ù†Ø©</span
          >
        </article>

        <article class="card" tabindex="0" aria-describedby="desc-age-over18">
          <h3>ğŸ§‘â€ğŸ“ Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø¨Ø§Ø¨ Ø£ÙƒØ«Ø± Ù…Ù† 18 Ø³Ù†Ø©</h3>
          <div
            class="progress"
            role="progressbar"
            aria-valuemin="0"
            aria-valuemax="100"
            aria-valuenow="{{ percent_over_18 }}"
            aria-describedby="desc-age-over18"
          >
            <div
              class="progress-bar"
              style="width: {{ percent_over_18 }}%;"
              id="bar-over-18"
            >
              {{ percent_over_18 }}%
            </div>
          </div>
          <p>Ø§Ù„Ø¹Ø¯Ø¯: {{ over_18_count }} Ù…Ø´Ø§Ø±Ùƒ</p>
          <span id="desc-age-over18" class="sr-only"
            >Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø¨Ø§Ø¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø§Ù„Ø°ÙŠÙ† ØªØ²ÙŠØ¯ Ø£Ø¹Ù…Ø§Ø±Ù‡Ù… Ø¹Ù† 18
            Ø³Ù†Ø©</span
          >
        </article>

        <article class="card" tabindex="0">
          <h3>ğŸ§  Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
          <button
            onclick="generateQuestionStats()"
            aria-label="Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ù„ÙƒÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©"
            title="Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ù„ÙƒÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©"
          >
            ğŸ“ˆ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
          </button>
        </article>
      </section>

      <section style="text-align: center" aria-label="Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…">
        <button onclick="window.print()" aria-label="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬">
          ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©
        </button>
        <button
          onclick="exportToExcel()"
          aria-label="ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ù„Ù‰ Ù…Ù„Ù Excel"
        >
          ğŸ“ ØªØµØ¯ÙŠØ± Excel
        </button>
        <button onclick="exportToPDF()" aria-label="ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ù„Ù‰ Ù…Ù„Ù PDF">
          ğŸ§¾ ØªØµØ¯ÙŠØ± PDF
        </button>
        <button onclick="showSummary()" aria-label="Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø°ÙƒÙŠ Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª">
          ğŸ“Š Ù…Ù„Ø®Øµ Ø°ÙƒÙŠ
        </button>
        <button
          onclick="toggleDarkMode()"
          aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ"
          title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ"
        >
          ğŸŒ™
        </button>
        <button
          onclick="downloadChartImage()"
          aria-label="ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ"
          title="ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ"
        >
          ğŸ–¼ï¸ ØªÙ†Ø²ÙŠÙ„ Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ
        </button>
      </section>

      <section aria-label="Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø¬Ù†Ø³ÙŠÙ†">
        <canvas
          id="genderChart"
          width="300"
          height="300"
          role="img"
          aria-label="Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ø¯Ø§Ø¦Ø±ÙŠ Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø¬Ù†Ø³ÙŠÙ†"
        ></canvas>
      </section>

      <section aria-label="Ø¬Ø¯ÙˆÙ„ ØªÙØµÙŠÙ„ÙŠ Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†">
        <table id="dataTable" class="display" aria-describedby="table-desc">
          <caption id="table-desc">
            Ø¬Ø¯ÙˆÙ„ ØªÙØµÙŠÙ„ÙŠ Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†
          </caption>
          <thead>
            <tr>
              <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
              <th>Ø§Ù„Ø³Ù†</th>
              <th>Ø§Ù„Ø¬Ù†Ø³</th>
              <th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
              <th>Ø§Ù„Ø³Ø¤Ø§Ù„ 1</th>
              <th>Ø§Ù„Ø³Ø¤Ø§Ù„ 2</th>
              <th>Ø§Ù„Ø³Ø¤Ø§Ù„ 3</th>
              <th>Ø§Ù„Ø³Ø¤Ø§Ù„ 4</th>
              <th>Ø§Ù„Ø³Ø¤Ø§Ù„ 5</th>
              <th>Ø§Ù„Ø³Ø¤Ø§Ù„ 6</th>
              <th>Ø§Ù„Ø³Ø¤Ø§Ù„ 7</th>
              <th>Ø§Ù„Ø³Ø¤Ø§Ù„ 8</th>
              <th>Ø§Ù„Ø³Ø¤Ø§Ù„ 9</th>
              <th>Ø§Ù„Ø³Ø¤Ø§Ù„ 10</th>
              <th>Ø§Ù„Ø³Ø¤Ø§Ù„ 11</th>
              <th>Ø§Ù„Ø³Ø¤Ø§Ù„ 12</th>
            </tr>
          </thead>
          <tbody>
            {% for r in responses %}
            <tr>
              <td>{{ r.email }}</td>
              <td>{{ r.age }}</td>
              <td>{{ r.gender }}</td>
              <td>{{ r.level }}</td>
              <td>{{ r.q1 }}</td>
              <td>{{ r.q2 }}</td>
              <td>{{ r.q3 }}</td>
              <td>{{ r.q4 }}</td>
              <td>{{ r.q5 }}</td>
              <td>{{ r.q6 }}</td>
              <td>{{ r.q7 }}</td>
              <td>{{ r.q8 }}</td>
              <td>{{ r.q9 }}</td>
              <td>{{ r.q10 }}</td>
              <td>{{ r.q11 }}</td>
              <td>{{ r.q12 }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
    </div>

    <!-- Ù…ÙƒØªØ¨Ø§Øª JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/countup.js@2.0.7/dist/countUp.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <!-- Ø§Ù„Ø³ÙƒØ±Ø¨Øª -->
    <script>
             function exportToExcel() {
        // Ù†ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ Ù†ÙØ³ Ø§Ù„Ù†Ø§ÙØ°Ø© Ù„ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
        window.location.href = '/export_excel';
      }


          const responses = {{ responses|tojson }};
          const genders = responses.map(r => r.gender);
          const total = responses.length;

          const countValues = arr => arr.reduce((acc, val) => {
            acc[val] = (acc[val] || 0) + 1;
            return acc;
          }, {});

          const genderCounts = countValues(genders);
          const q1Counts = countValues(responses.map(r => r.q1));
          const q2Counts = countValues(responses.map(r => r.q2));

          // 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø¹Ø¯Ø§Ø¯
          function animateStats() {
            new CountUp("count-total", total, { duration: 2 }).start();
            const percentFem = Math.round((genderCounts['Ø£Ù†Ø«Ù‰'] || 0) / total * 100);
            const percentMale = Math.round((genderCounts['Ø°ÙƒØ±'] || 0) / total * 100);

            const barFem = document.getElementById("bar-females");
            const barMale = document.getElementById("bar-males");
            barFem.style.width = percentFem + "%";
            barFem.textContent = percentFem + "%";
            barMale.style.width = percentMale + "%";
            barMale.textContent = percentMale + "%";

            new CountUp("count-q1", q1Counts['Ù†Ø¹Ù…'] || 0, { duration: 2 }).start();
            new CountUp("count-q2", q2Counts['Ù†Ø¹Ù…'] || 0, { duration: 2 }).start();
          }

          // 2. ØªØµØ¯ÙŠØ± CSV
          function exportToExcel() {
            let table = document.getElementById("dataTable");
            let csv = "";
            for (let row of table.rows) {
              let cells = Array.from(row.cells).map(cell => `"${cell.innerText.replace(/"/g, '""')}"`);
              csv += cells.join(",") + "\n";
            }
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "survey_results.csv";
            document.body.appendChild(link);
            link.click();
            link.remove();
          }

          // 3. ØªØµØ¯ÙŠØ± PDF
          async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
              orientation: "landscape",
              unit: "pt",
              format: "a4"
            });
            doc.text("Ù†ØªØ§Ø¦Ø¬ Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© ÙˆØ§Ù„Ø£Ø®Ù„Ø§Ù‚ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©", 40, 40);
            doc.autoTable({
              html: '#dataTable',
              startY: 60,
              theme: 'grid',
              styles: { fontSize: 8, cellPadding: 3 },
              headStyles: { fillColor: [0, 123, 255] },
            });
            doc.save("survey_results.pdf");
          }

          // 4. Ù…Ù„Ø®Øµ Ø°ÙƒÙŠ + ØªØ£Ø«ÙŠØ± Confetti
          function showSummary() {
            const percentFem = Math.round((genderCounts['Ø£Ù†Ø«Ù‰'] || 0) / total * 100);
            const percentMale = Math.round((genderCounts['Ø°ÙƒØ±'] || 0) / total * 100);
            let analysis = '';
            if ((genderCounts['Ø°ÙƒØ±'] || 0) > (genderCounts['Ø£Ù†Ø«Ù‰'] || 0)) {
              analysis += 'ğŸ‘¨â€ğŸ“ Ø§Ù„Ø°ÙƒÙˆØ± Ø£ÙƒØ«Ø± Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†.<br>';
            }
            if ((q1Counts['Ù„Ø§'] || 0) > (q1Counts['Ù†Ø¹Ù…'] || 0)) {
              analysis += 'âš ï¸ Ù…Ø¹Ø¸Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ù„Ù… ÙŠØ³Ù…Ø¹ÙˆØ§ Ø¨Ù…ØµØ·Ù„Ø­ Ø§Ù„Ø£Ø®Ù„Ø§Ù‚ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©.<br>';
            }
            if ((q2Counts['Ù†Ø¹Ù…'] || 0) > (q1Counts['Ù†Ø¹Ù…'] || 0)) {
              analysis += 'ğŸ“š Ø§Ù„ÙƒØ«ÙŠØ± Ø¯Ø±Ø³ÙˆØ§ Ø§Ù„Ø£Ø®Ù„Ø§Ù‚ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© Ø­ØªÙ‰ Ø¥Ù† Ù„Ù… ÙŠØ³Ù…Ø¹ÙˆØ§ Ø¨Ø§Ù„Ù…ØµØ·Ù„Ø­.<br>';
            }

            Swal.fire({
              title: 'ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬',
              html: `<p>ğŸ“Œ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†: <strong>${total}</strong></p>
                     <p>ğŸ‘©â€ğŸ“ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø§Ø«: ${percentFem}%</p>
                     <p>ğŸ‘¨â€ğŸ“ Ù†Ø³Ø¨Ø© Ø§Ù„Ø°ÙƒÙˆØ±: ${percentMale}%</p>
                     <p>â“ Ø³Ù…Ø¹ÙˆØ§ Ø¨Ù…ØµØ·Ù„Ø­ Ø§Ù„Ø£Ø®Ù„Ø§Ù‚ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©: ${q1Counts['Ù†Ø¹Ù…'] || 0} Ù…Ø´Ø§Ø±Ùƒ</p>
                     <p>ğŸ“š Ø¯Ø±Ø³ÙˆØ§ Ø§Ù„Ø£Ø®Ù„Ø§Ù‚: ${q2Counts['Ù†Ø¹Ù…'] || 0} Ù…Ø´Ø§Ø±Ùƒ</p>
                     <hr><p>${analysis}</p>`,
              icon: 'info',
              backdrop: true,
              showConfirmButton: true,
              willClose: () => confetti.clear()
            });
            confetti.render();
            setTimeout(() => confetti.clear(), 6000);
          }

          // 5. ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ù„ÙƒÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ø¹ Ø¹Ø±Ø¶ Ù…Ù†Ø³Ù‚
          function generateQuestionStats() {
            let html = '<div style="text-align:right; direction:rtl;">';
            for (let i = 1; i <= 12; i++) {
              const key = 'q' + i;
              const values = responses.map(r => r[key]);
              const counts = countValues(values);
              html += `<h4>Ø§Ù„Ø³Ø¤Ø§Ù„ ${i}:</h4><ul>`;
              for (const [answer, count] of Object.entries(counts)) {
                html += `<li>${answer}: ${count} Ù…Ø´Ø§Ø±Ùƒ</li>`;
              }
              html += '</ul>';
            }
            html += '</div>';
            Swal.fire({
              title: 'ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ÙØµÙ„',
              html,
              icon: 'info',
              width: 600,
              scrollbarPadding: false,
              confirmButtonText: 'Ø¥ØºÙ„Ø§Ù‚'
            });
          }

          // 6. Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ø¯Ø§Ø¦Ø±ÙŠ Ù„Ù„Ù†ÙˆØ¹ Ù…Ø¹ Ø£Ù„ÙˆØ§Ù† ØªÙØ§Ø¹Ù„ÙŠØ©
          function renderChart() {
            const ctx = document.getElementById("genderChart").getContext("2d");
            window.genderChartInstance = new Chart(ctx, {
              type: "doughnut",
              data: {
                labels: ["Ø°ÙƒØ±", "Ø£Ù†Ø«Ù‰"],
                datasets: [{
                  data: [genderCounts['Ø°ÙƒØ±'] || 0, genderCounts['Ø£Ù†Ø«Ù‰'] || 0],
                  backgroundColor: ["#007bffcc", "#ff6384cc"],
                  borderColor: ["#0056b3", "#cc416bcc"],
                  borderWidth: 2,
                  hoverOffset: 30,
                  hoverBorderWidth: 4
                }]
              },
              options: {
                responsive: true,
                animation: {
                  animateScale: true,
                  animateRotate: true,
                },
                plugins: {
                  legend: {
                    position: 'bottom',
                    labels: {
                      font: { size: 14, weight: 'bold' }
                    }
                  },
                  tooltip: {
                    callbacks: {
                      label: context => `${context.label}: ${context.parsed} Ù…Ø´Ø§Ø±Ùƒ`
                    }
                  }
                }
              }
            });
          }

          // 7. ØªÙØ¹ÙŠÙ„ datatable Ù…Ø¹ Ø¨Ø­Ø« ÙˆÙÙ„ØªØ±Ø© Ù…ØªÙ‚Ø¯Ù…Ø©
          $(document).ready(() => {
            $('#dataTable').DataTable({
              language: {
                url: "https://cdn.datatables.net/plug-ins/1.13.4/i18n/ar.json"
              },
              pageLength: 10,
              lengthMenu: [5, 10, 25, 50],
              responsive: true,
              scrollX: true,
              autoWidth: false,
              ordering: true,
              order: [[1, 'asc']]
            });
            animateStats();
            renderChart();
            confetti = new ConfettiGenerator({ target: 'confetti-canvas', max: 150, size: 1, clock: 25, rotate: true });
          });

          // 8. ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„/Ø§Ù„Ù†Ù‡Ø§Ø± (Dark Mode Toggle)
          let darkMode = false;
          function toggleDarkMode() {
            darkMode = !darkMode;
            if(darkMode){
              document.body.style.background = '#121212';
              document.body.style.color = '#ccc';
              document.querySelector('.container').style.background = 'rgba(40, 40, 40, 0.95)';
              Swal.fire({
                icon: 'success',
                title: 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ',
                timer: 2000,
                toast: true,
                position: 'top-end',
                showConfirmButton: false
              });
            } else {
              document.body.style.background = 'linear-gradient(135deg, #0f2027, #203a43, #2c5364)';
              document.body.style.color = '#fff';
              document.querySelector('.container').style.background = 'rgba(0, 0, 0, 0.75)';
              Swal.fire({
                icon: 'success',
                title: 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ',
                timer: 2000,
                toast: true,
                position: 'top-end',
                showConfirmButton: false
              });
            }
          }

          // 9. ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ù„Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ (Download chart image)
          function downloadChartImage() {
            if(window.genderChartInstance){
              const url = window.genderChartInstance.toBase64Image();
              const a = document.createElement('a');
              a.href = url;
              a.download = 'gender_chart.png';
              a.click();
            } else {
              Swal.fire('Ø®Ø·Ø£', 'Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹', 'error');
            }
          }

          // 10. Ø¹Ø¯Ø§Ø¯ ØªÙØ§Ø¹Ù„ÙŠ Ø¹Ù„Ù‰ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (Hover effect)
          document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('mouseenter', () => {
              card.style.boxShadow = '0 0 40px #00eaffdd';
            });
            card.addEventListener('mouseleave', () => {
              card.style.boxShadow = '0 0 15px #00d8ffcc';
            });
          });
    </script>
  </body>
</html>
